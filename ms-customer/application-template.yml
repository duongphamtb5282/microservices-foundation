# ==============================================================================
# APPLICATION CONFIGURATION TEMPLATE
# ==============================================================================
# This file serves as a template for configuring the microservices.
# Copy values to application.yml and customize per environment.
# Use environment variables for sensitive data.
# ==============================================================================

# ==============================================================================
# SPRING BOOT CORE CONFIGURATION
# ==============================================================================
mongo:
  enabled: ${MONGO_ENABLED:true}
  uri: ${MONGODB_URI:mongodb://localhost:27017/customerdb}
  host: ${MONGODB_HOST:localhost}
  port: ${MONGODB_PORT:27017}
  database: ${MONGODB_DATABASE:customerdb}
  username: ${MONGODB_USERNAME:}
  password: ${MONGODB_PASSWORD:}
  authenticationDatabase: ${MONGODB_AUTH_DATABASE:admin}
  tlsEnabled: ${MONGODB_TLS_ENABLED:false}
  retryReads: ${MONGODB_RETRY_READS:true}
  retryWrites: ${MONGODB_RETRY_WRITES:true}
  readPreference: ${MONGODB_READ_PREFERENCE:primary}
  writeConcern: ${MONGODB_WRITE_CONCERN:MAJORITY}
  connectionTimeout: ${MONGODB_CONNECTION_TIMEOUT:PT10S}
  socketTimeout: ${MONGODB_SOCKET_TIMEOUT:PT30S}
  serverSelectionTimeout: ${MONGODB_SERVER_SELECTION_TIMEOUT:PT30S}
  pool:
    minSize: ${MONGODB_POOL_MIN_SIZE:0}
    maxSize: ${MONGODB_POOL_MAX_SIZE:20}
    maxWaitTime: ${MONGODB_MAX_WAIT_TIME:PT2S}
    maxConnectionLifeTime: ${MONGODB_MAX_CONNECTION_LIFE_TIME:PT0S}
    maxConnectionIdleTime: ${MONGODB_MAX_CONNECTION_IDLE_TIME:PT1M}

spring:
  application:
    name: ${SPRING_APPLICATION_NAME:ms-customer}

  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}

  # MongoDB Configuration
  data:
    mongodb:
      uri: ${mongo.uri:}
      host: ${mongo.host}
      port: ${mongo.port}
      database: ${mongo.database}
      username: ${mongo.username:}
      password: ${mongo.password:}
      authentication-database: ${mongo.authenticationDatabase:admin}

  # Redis Configuration
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    database: ${REDIS_DATABASE:0}
    timeout: ${REDIS_TIMEOUT:2000}
    lettuce:
      pool:
        max-active: ${REDIS_POOL_MAX_ACTIVE:8}
        max-idle: ${REDIS_POOL_MAX_IDLE:8}
        min-idle: ${REDIS_POOL_MIN_IDLE:0}
        max-wait: ${REDIS_POOL_MAX_WAIT:-1}

  # Kafka Configuration
  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    consumer:
      group-id: ${KAFKA_CONSUMER_GROUP_ID:customer-service}
      auto-offset-reset: ${KAFKA_AUTO_OFFSET_RESET:earliest}
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.StringSerializer

# ==============================================================================
# SERVER CONFIGURATION
# ==============================================================================
server:
  port: ${SERVER_PORT:8080}
  servlet:
    context-path: ${SERVER_CONTEXT_PATH:/}
  compression:
    enabled: ${SERVER_COMPRESSION_ENABLED:true}
  error:
    include-message: ${SERVER_ERROR_INCLUDE_MESSAGE:always}
    include-stacktrace: ${SERVER_ERROR_INCLUDE_STACKTRACE:never}

# ==============================================================================
# MANAGEMENT & ACTUATOR CONFIGURATION
# ==============================================================================
management:
  endpoints:
    web:
      base-path: ${ACTUATOR_BASE_PATH:/actuator}
      exposure:
        include: ${ACTUATOR_ENDPOINTS:health,info,metrics,prometheus}
  endpoint:
    health:
      show-details: ${ACTUATOR_HEALTH_SHOW_DETAILS:when-authorized}
      enabled: ${ACTUATOR_HEALTH_ENABLED:true}
    info:
      enabled: ${ACTUATOR_INFO_ENABLED:true}
    metrics:
      enabled: ${ACTUATOR_METRICS_ENABLED:true}
  metrics:
    export:
      prometheus:
        enabled: ${PROMETHEUS_ENABLED:true}

# ==============================================================================
# LOGGING CONFIGURATION
# ==============================================================================
logging:
  level:
    root: ${LOG_LEVEL_ROOT:INFO}
    com.pacific: ${LOG_LEVEL_APP:DEBUG}
    com.pacific.auth: ${LOG_LEVEL_AUTH:DEBUG}
    com.pacific.core: ${LOG_LEVEL_BACKEND_CORE:DEBUG}
    org.springframework: ${LOG_LEVEL_SPRING:INFO}
    org.springframework.security: ${LOG_LEVEL_SPRING_SECURITY:DEBUG}
    org.hibernate: ${LOG_LEVEL_HIBERNATE:WARN}
    org.hibernate.SQL: ${LOG_LEVEL_HIBERNATE_SQL:DEBUG}
    org.hibernate.type.descriptor.sql.BasicBinder: ${LOG_LEVEL_HIBERNATE_BINDER:TRACE}
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: ${LOG_FILE:logs/application.log}
    max-size: ${LOG_FILE_MAX_SIZE:10MB}
    max-history: ${LOG_FILE_MAX_HISTORY:30}

# ==============================================================================
# OPENAPI/SWAGGER CONFIGURATION
# ==============================================================================
openapi:
  title: ${API_TITLE:Customer Service API}
  description: ${API_DESCRIPTION:Customer Management REST API}
  version: ${API_VERSION:1.0.0}
  license:
    name: ${API_LICENSE_NAME:Apache 2.0}
    url: ${API_LICENSE_URL:https://www.apache.org/licenses/LICENSE-2.0}
  server-urls:
    - ${API_SERVER_URL:http://localhost:8084}

springdoc:
  api-docs:
    path: ${SPRINGDOC_API_DOCS_PATH:/v3/api-docs}
    enabled: ${SPRINGDOC_API_DOCS_ENABLED:true}
  swagger-ui:
    path: ${SPRINGDOC_SWAGGER_UI_PATH:/swagger-ui.html}
    enabled: ${SPRINGDOC_SWAGGER_UI_ENABLED:true}
    operationsSorter: ${SPRINGDOC_OPERATIONS_SORTER:method}
    tagsSorter: ${SPRINGDOC_TAGS_SORTER:alpha}

# ==============================================================================
# BACKEND-CORE CONFIGURATION
# ==============================================================================
backend-core:
  # Cache Configuration
  cache:
    enabled: ${CACHE_ENABLED:true}
    type: ${CACHE_TYPE:redis}

    # L1 Cache (Caffeine - In-Memory)
    l1-cache:
      enabled: ${L1_CACHE_ENABLED:true}
      max-size: ${L1_CACHE_MAX_SIZE:1000}
      ttl: ${L1_CACHE_TTL:15m}

    # L2 Cache (Redis - Distributed)
    l2-cache:
      enabled: ${L2_CACHE_ENABLED:true}
      ttl: ${L2_CACHE_TTL:30m}

    # Per-Cache TTL Overrides
    cache-names:
      users:
        ttl: ${CACHE_USERS_TTL:1h}
      roles:
        ttl: ${CACHE_ROLES_TTL:2h}
      tokens:
        ttl: ${CACHE_TOKENS_TTL:15m}
      permissions:
        ttl: ${CACHE_PERMISSIONS_TTL:1h}

  # Security Configuration
  security:
    enabled: ${SECURITY_ENABLED:true}
    default-auth-mode: ${SECURITY_DEFAULT_AUTH_MODE:jwt}
    enable-cors: ${SECURITY_ENABLE_CORS:true}
    enable-csrf: ${SECURITY_ENABLE_CSRF:false}

    # CORS Configuration
    cors:
      allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:4200}
      allowed-methods: ${CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,OPTIONS,PATCH}
      allowed-headers: ${CORS_ALLOWED_HEADERS:*}
      exposed-headers: ${CORS_EXPOSED_HEADERS:Authorization,Content-Type}
      allow-credentials: ${CORS_ALLOW_CREDENTIALS:true}
      max-age: ${CORS_MAX_AGE:3600}

  # Database Configuration
  database:
    enabled: ${DB_ENABLED:true}
    pool:
      type: ${DB_POOL_TYPE:hikari}
      min-idle: ${DB_POOL_MIN_IDLE:2}
      max-pool-size: ${DB_POOL_MAX_SIZE:10}
      connection-timeout: ${DB_CONNECTION_TIMEOUT:20s}
      idle-timeout: ${DB_IDLE_TIMEOUT:5m}
      max-lifetime: ${DB_MAX_LIFETIME:10m}
    health-check:
      enabled: ${DB_HEALTH_CHECK_ENABLED:true}
      timeout: ${DB_HEALTH_CHECK_TIMEOUT:5s}

  # Monitoring Configuration
  monitoring:
    enabled: ${MONITORING_ENABLED:true}
    enable-health-checks: ${MONITORING_HEALTH_CHECKS_ENABLED:true}
    enable-metrics: ${MONITORING_METRICS_ENABLED:true}
    enable-logging: ${MONITORING_LOGGING_ENABLED:true}
    log-level: ${MONITORING_LOG_LEVEL:INFO}

# ==============================================================================
# CUSTOMER-SERVICE SPECIFIC CONFIGURATION
# ==============================================================================
customer:
  # MongoDB Configuration
  mongodb:
    connection-pool-size: ${MONGODB_CONNECTION_POOL_SIZE:10}
    max-wait-time: ${MONGODB_MAX_WAIT_TIME:120000}
    max-connection-idle-time: ${MONGODB_MAX_CONNECTION_IDLE_TIME:30000}

  # Cache Configuration
  cache:
    ttl: ${CACHE_TTL:3600}
    size: ${CACHE_SIZE:10000}
    caffeine:
      spec: ${CACHE_CAFFEINE_SPEC:maximumSize=10000,expireAfterWrite=1h}

  # WebSocket Configuration
  websocket:
    enabled: ${WEBSOCKET_ENABLED:true}
    max-connections: ${WEBSOCKET_MAX_CONNECTIONS:1000}
    heartbeat-interval: ${WEBSOCKET_HEARTBEAT_INTERVAL:30s}
    max-message-size: ${WEBSOCKET_MAX_MESSAGE_SIZE:64KB}

  # Security Configuration
  security:
    encryption:
      enabled: ${SECURITY_ENCRYPTION_ENABLED:true}
      algorithm: ${SECURITY_ENCRYPTION_ALGORITHM:AES}
      key-size: ${SECURITY_ENCRYPTION_KEY_SIZE:256}

  # Events Configuration
  events:
    customer-created:
      topic: ${CUSTOMER_EVENTS_TOPIC:customer.events}
    customer-updated:
      topic: ${CUSTOMER_EVENTS_TOPIC:customer.events}
    customer-status-changed:
      topic: ${CUSTOMER_STATUS_CHANGED_TOPIC:customer.events}

  # API Configuration
  api:
    max-page-size: ${API_MAX_PAGE_SIZE:100}
    default-page-size: ${API_DEFAULT_PAGE_SIZE:20}

# ==============================================================================
# PROFILE-SPECIFIC OVERRIDES
# ==============================================================================

---
# Development Profile
spring:
  config:
    activate:
      on-profile: dev

logging:
  level:
    root: DEBUG
    com.pacific: DEBUG

backend-core:
  security:
    cors:
      allowed-origins: "*"
      allow-credentials: false

auth-service:
  security:
    authentication:
      jwt:
        validation:
          allow-localhost: true

---
# Test Profile
spring:
  config:
    activate:
      on-profile: test
  datasource:
    url: jdbc:h2:mem:testdb
    driver-class-name: org.h2.Driver
  jpa:
    hibernate:
      ddl-auto: create-drop

---
# Production Profile
spring:
  config:
    activate:
      on-profile: prod

logging:
  level:
    root: WARN
    com.pacific: INFO

backend-core:
  security:
    cors:
      # Must be explicitly set in production, no wildcard allowed
      allowed-origins: ${CORS_ALLOWED_ORIGINS}
      allow-credentials: true

auth-service:
  security:
    authentication:
      jwt:
        validation:
          require-exact-match: true
          allow-localhost: false
      keycloak:
        disable-trust-manager: false
        allow-any-hostname: false

---
# Docker Profile
spring:
  config:
    activate:
      on-profile: docker
  datasource:
    url: jdbc:postgresql://postgres:5432/auth_db
  redis:
    host: redis
  kafka:
    bootstrap-servers: kafka:9092
