# Staging Profile Configuration
spring:
  config:
    activate:
      on-profile: stg

  redis:
    host: ${REDIS_HOST:redis.customer-service.svc.cluster.local}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    timeout: ${REDIS_TIMEOUT:2000}ms
    lettuce:
      pool:
        max-active: ${REDIS_POOL_MAX_ACTIVE:8}
        max-idle: ${REDIS_POOL_MAX_IDLE:8}
        min-idle: ${REDIS_POOL_MIN_IDLE:0}

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:kafka.kafka.svc.cluster.local:9092}
    security:
      protocol: ${KAFKA_SECURITY_PROTOCOL:SASL_SSL}
    sasl:
      mechanism: ${KAFKA_SASL_MECHANISM:SCRAM-SHA-256}
      jaas:
        config: org.apache.kafka.common.security.scram.ScramLoginModule required username="${KAFKA_USERNAME}" password="${KAFKA_PASSWORD}";
    ssl:
      truststore:
        location: ${KAFKA_SSL_TRUSTSTORE_LOCATION:/etc/ssl/certs/ca-certificates.crt}

  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${JWT_ISSUER_URI:https://auth-service.customer-service.svc.cluster.local}

customer:
  websocket:
    max-connections: ${WEBSOCKET_MAX_CONNECTIONS:2000}
    heartbeat-interval: ${WEBSOCKET_HEARTBEAT_INTERVAL:30s}
    max-message-size: ${WEBSOCKET_MAX_MESSAGE_SIZE:128KB}

  cache:
    ttl: ${CACHE_TTL:1800}
    size: ${CACHE_SIZE:10000}
    caffeine:
      spec: ${CACHE_SPEC:maximumSize=10000,expireAfterWrite=30m}

  security:
    encryption:
      enabled: ${CUSTOMER_ENCRYPTION_ENABLED:true}
      algorithm: ${CUSTOMER_ENCRYPTION_ALGORITHM:AES}
      key-size: ${CUSTOMER_ENCRYPTION_KEY_SIZE:256}

logging:
  level:
    com.pacific.customer: ${LOGGING_LEVEL_COM_DEMO_CUSTOMER:INFO}
    org.springframework.security: ${LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_SECURITY:INFO}
    org.springframework.data.mongodb: ${LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_DATA_MONGODB:INFO}
    reactor.netty: ${LOGGING_LEVEL_REACTOR_NETTY:WARN}
  file:
    name: ${LOGGING_FILE_NAME:logs/ms-customer-stg.log}
    max-size: ${LOGGING_FILE_MAX_SIZE:100MB}
    max-history: ${LOGGING_FILE_MAX_HISTORY:14}

management:
  endpoint:
    health:
      show-details: ${MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS:when_authorized}
  metrics:
    tags:
      environment: staging

  lifecycle:
    timeout-per-shutdown-phase: 30s

# Staging-specific settings
server:
  compression:
    enabled: true
    mime-types: text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
    min-response-size: 1024

mongo:
  uri: ${MONGODB_URI:mongodb://admin:password@mongodb.customer-service.svc.cluster.local:27017/customerdb?ssl=false&replicaSet=rs0&readPreference=secondaryPreferred}
  username: ${MONGODB_USERNAME:admin}
  password: ${MONGODB_PASSWORD:password}
  authenticationDatabase: ${MONGODB_AUTH_DATABASE:admin}
  pool:
    maxSize: ${MONGODB_CONNECTION_POOL_SIZE:10}
    maxWaitTime: ${MONGODB_MAX_WAIT_TIME:PT120S}
    maxConnectionIdleTime: ${MONGODB_MAX_CONNECTION_IDLE_TIME:PT30S}
