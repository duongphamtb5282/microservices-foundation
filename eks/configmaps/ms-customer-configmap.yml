apiVersion: v1
kind: ConfigMap
metadata:
  name: ms-customer-config
  namespace: ms-customer-prod
  labels:
    app: ms-customer
    service: ms-customer
    environment: production
    # EKS specific labels
    app.kubernetes.io/name: ms-customer
    app.kubernetes.io/component: customer-service
    app.kubernetes.io/part-of: microservices
    app.kubernetes.io/managed-by: eks
spec:
  data:
    application-prod.yml: |
      spring:
        application:
          name: ms-customer
        profiles:
          active: prod
        data:
          mongodb:
            uri: ${SPRING_DATA_MONGODB_URI}
            database: customerdb
        kafka:
          bootstrap-servers: ${SPRING_KAFKA_BOOTSTRAP_SERVERS}
          consumer:
            group-id: customer-service
            auto-offset-reset: earliest
            properties:
              spring.json.trusted.packages: "com.pacific.customer.domain.event"
          producer:
            acks: all
            retries: 3
            key-serializer: org.apache.kafka.common.serialization.StringSerializer
            value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
        redis:
          host: ${SPRING_DATA_REDIS_HOST}
          port: ${SPRING_DATA_REDIS_PORT}
          timeout: 2000ms
        security:
          oauth2:
            resourceserver:
              jwt:
                issuer-uri: ${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI}

      management:
        endpoints:
          web:
            exposure:
              include: health,info,metrics,prometheus
        metrics:
          export:
            prometheus:
              enabled: true
        endpoint:
          health:
            show-details: when_authorized

      customer:
        websocket:
          enabled: true
          max-connections: 1000
          heartbeat-interval: 30s
          max-message-size: 64KB
        mongodb:
          connection-pool-size: 10
          max-wait-time: 120000
          max-connection-idle-time: 30000
        cache:
          ttl: 3600
          size: 10000
          caffeine:
            spec: maximumSize=10000,expireAfterWrite=1h
        security:
          encryption:
            enabled: true
            algorithm: AES
            key-size: 256
        events:
          customer-created:
            topic: customer.events
          customer-updated:
            topic: customer.events
          customer-status-changed:
            topic: customer.events
        api:
          max-page-size: 100
          default-page-size: 20

      logging:
        level:
          root: INFO
          com.pacific.customer: DEBUG
          reactor.netty: INFO
          org.springframework.data.mongodb: DEBUG
